## 基本概念

- 存储 key-value 键值对 , value 可以是复杂结构的对象 , key 可以是 value 对象的属性也可以是二进制对象
  - 可使用 value 对象中的属性来创建索引以快速查找或枚举排序
- 建立在事务的数据库模型 , 保证多个实例之间的操作不会互相干扰(持久性,隔离性,原子性,一致性)
  - 丰富的 API 都绑定在特定的 transaction 上 , 因此 IndexedDB 中所有操作都必须经由事务上下文中进行
  - 事务有明确的生命周期
  - 事务可以自动提交也可以手动提交
- IndexedDB API 大部分是异步的
- IndexedDB 使用了大量的 request
  - request : 接收成功或失败 DOM events 的对象
- 当有结果返回是 , IndexedDB 使用 DOM events 来通知你
- IndexedDB 是面向对象的
- IndexedDB 不适用 SQL
- IndexedDB 坚持同源策略 , 只能访问同源的 IndexedDB 数据

## 事务的生命周期

> 与事件循环联系非常紧密

## 基本使用模式

> IndexedDB 的主要设计目标之一就是允许大量数据可以被存储以供离线使用

- open DB
- create a store obj in DB
- 启动事务 , 通过发送请求来执行数据库操作
- 通过监听正确类型的 DOM 事件以等待操作完成
- 在操作结果上进行一些操作(可以在 request 对象在找到)

### 创建和更新数据库版本号

创建一个新数据库或增加已存在数据库的版本号时会触发 onupgradeneeded 事件

## 构建数据库

IndexDB 使用对象存仓库而不是表 , 且一个单独的数据库可以包含任何数量的对象存储空间

使用合适的作用域和模式来加速数据库访问 :

- 定义作用域时, 只指定你用到的对象仓库 , 这样你可以同时运行多个互不相含重叠作用域的事务
- 只在必要时指定 readwrite 事务. 你可以同时执行多个 readonly 事务,及时它们有重叠作用域,然而, 对于在一个对象仓库上你只能运行一个 readwrite 事务
